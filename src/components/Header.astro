---
import Container from "@components/Container.astro";
import Link from "@components/Link.astro";
import { SITE } from "@consts";
---

<header>
  <Container>
    <div class="flex items-center justify-between gap-4">
      <div class="flex items-baseline gap-4">
        <Link href="/" underline={false}>
          <div class="font-display font-semibold text-4xl md:text-5xl lg:text-6xl">
            {SITE.NAME}
          </div>
        </Link>
        <nav class="flex gap-1 font-display text-lg md:text-xl lg:text-2xl">
          <Link href="/blog" underline={false}>
            blog
          </Link>
          <span>
            {`/`}
          </span>
          <Link href="/photos" underline={false}>
            photos
          </Link>
          <span>
            {`/`}
          </span>
          <Link href="/about" underline={false}>
            about
          </Link>
        </nav>
      </div>

      <!-- Theme Toggle Button -->
      <button
        id="theme-toggle"
        class="w-12 h-12 rounded-full bg-black dark:bg-white flex items-center justify-center hover:opacity-80 transition-opacity flex-shrink-0"
        aria-label="Toggle theme"
      >
        <svg id="sun-icon" class="w-6 h-6 text-white dark:text-black hidden dark:block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
        </svg>
        <svg id="moon-icon" class="w-6 h-6 text-white dark:text-black block dark:hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
        </svg>
      </button>
    </div>
  </Container>
</header>

<script is:inline>
  function setupThemeToggle() {
    const themeToggle = document.getElementById('theme-toggle');
    if (!themeToggle) return;

    themeToggle.addEventListener('click', () => {
      const isDark = document.documentElement.classList.contains('dark');

      // Create CSS to disable transitions during theme change
      const css = document.createElement("style");
      css.appendChild(
        document.createTextNode(
          `* {
             -webkit-transition: none !important;
             -moz-transition: none !important;
             -o-transition: none !important;
             -ms-transition: none !important;
             transition: none !important;
          }`
        )
      );
      document.head.appendChild(css);

      if (isDark) {
        localStorage.setItem('theme', 'light');
        document.documentElement.classList.remove('dark');
      } else {
        localStorage.setItem('theme', 'dark');
        document.documentElement.classList.add('dark');
      }

      // Force reflow and remove transition disabling
      window.getComputedStyle(css).opacity;
      document.head.removeChild(css);
    });
  }

  document.addEventListener('DOMContentLoaded', setupThemeToggle);
  document.addEventListener('astro:page-load', setupThemeToggle);
</script>
